<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colorado Sky Runner - Project Architecture</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f8f8f8;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border: 2px solid #ccc;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            border-bottom: 3px solid #333;
            padding-bottom: 10px;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        h2 {
            border-left: 5px solid #666;
            padding-left: 15px;
            margin-top: 40px;
            background: #f5f5f5;
            padding: 10px 15px;
        }

        h3 {
            border-bottom: 1px solid #999;
            padding-bottom: 5px;
        }

        .file-structure {
            background: #f9f9f9;
            padding: 20px;
            border: 1px solid #ddd;
            font-family: monospace;
            margin: 20px 0;
        }

        .data-flow {
            background: white;
            border: 2px solid #333;
            padding: 20px;
            margin: 20px 0;
        }

        .flow-step {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 10px;
            border: 1px solid #ccc;
            background: #fafafa;
        }

        .flow-arrow {
            font-size: 20px;
            margin: 0 15px;
            color: #666;
        }

        .component {
            background: #eee;
            padding: 8px 12px;
            border: 1px solid #999;
            margin: 5px;
            display: inline-block;
            min-width: 120px;
            text-align: center;
        }

        .input-component {
            background: #e8e8e8;
            border-left: 4px solid #666;
        }

        .processing-component {
            background: #f0f0f0;
            border-left: 4px solid #999;
        }

        .output-component {
            background: #f5f5f5;
            border-left: 4px solid #333;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border: 1px solid #ddd;
            font-family: 'Courier New', monospace;
        }

        .section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
        }

        ul {
            margin: 10px 0;
        }

        li {
            margin: 8px 0;
        }

        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .tech-item {
            padding: 15px;
            border: 1px solid #999;
            background: #f8f8f8;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Colorado Sky Runner</h1>
        <h2>Project Architecture & Data Flow</h2>

        <div class="section">
            <h3>Project Overview</h3>
            <p>Colorado Sky Runner is a 3D bird flying game built with Three.js that uses MicroBit sensor data for real-time control. Players navigate through a mountainous environment collecting golden hoops while avoiding jets and smog clouds.</p>
        </div>

        <div class="section">
            <h2>File Structure</h2>
            <div class="file-structure">
├── coloradoskyrunner.html    # Main HTML entry point
├── main.js                   # Core game loop and initialization
├── scene.js                  # Three.js scene setup and rendering
├── bird.js                   # Bird model, animation, and movement
├── microbit.js              # MicroBit serial communication
├── voice.js                 # Voice command recognition
├── collisions.js            # Collision detection and scoring
├── clouds.js                # Cloud objects, hoops, and jets
├── mountains.js             # Mountain environment generation
├── microbit.py              # MicroBit Python sensor code
└── assets/                  # 3D models and audio files
    ├── bird.glb
    ├── mountain.glb
    ├── jet.glb
    └── sounds/
            </div>
        </div>

        <div class="section">
            <h2>Technology Stack</h2>
            <div class="tech-stack">
                <div class="tech-item">
                    <strong>Frontend</strong><br>
                    HTML5, CSS3, JavaScript ES6
                </div>
                <div class="tech-item">
                    <strong>3D Graphics</strong><br>
                    Three.js, WebGL, GLTF
                </div>
                <div class="tech-item">
                    <strong>Hardware Interface</strong><br>
                    Web Serial API, MicroBit
                </div>
                <div class="tech-item">
                    <strong>Audio/Voice</strong><br>
                    Web Audio API, Speech Recognition
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Data Flow Architecture</h2>
            <div class="data-flow">
                <h3>1. Input Layer</h3>
                <div class="flow-step">
                    <div class="component input-component">MicroBit Sensors</div>
                    <div class="flow-arrow">→</div>
                    <div class="component input-component">microbit.py</div>
                    <div class="flow-arrow">→</div>
                    <div class="component processing-component">Serial Data</div>
                </div>
                <p><strong>Data Format:</strong> <code>"roll,pitch,touch"</code> (e.g., "15.2,-8.7,1")</p>
                <ul>
                    <li><strong>Roll:</strong> Sideways tilt (X-axis movement)</li>
                    <li><strong>Pitch:</strong> Forward/backward tilt (Z-axis movement)</li>
                    <li><strong>Touch:</strong> Foil sensor contact (height increase)</li>
                </ul>

                <h3>2. Processing Layer</h3>
                <div class="flow-step">
                    <div class="component processing-component">microbit.js</div>
                    <div class="flow-arrow">→</div>
                    <div class="component processing-component">Data Parsing</div>
                    <div class="flow-arrow">→</div>
                    <div class="component processing-component">Smoothing</div>
                    <div class="flow-arrow">→</div>
                    <div class="component processing-component">bird.js</div>
                </div>

                <h3>3. Game Logic Layer</h3>
                <div class="flow-step">
                    <div class="component processing-component">main.js</div>
                    <div class="flow-arrow">→</div>
                    <div class="component processing-component">Animation Loop</div>
                    <div class="flow-arrow">→</div>
                    <div class="component processing-component">collisions.js</div>
                </div>

                <h3>4. Rendering Layer</h3>
                <div class="flow-step">
                    <div class="component output-component">scene.js</div>
                    <div class="flow-arrow">→</div>
                    <div class="component output-component">Three.js Renderer</div>
                    <div class="flow-arrow">→</div>
                    <div class="component output-component">WebGL Canvas</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>JavaScript File Descriptions</h2>

            <h3>main.js - Game Controller & Entry Point</h3>
            <ul>
                <li><strong>Purpose:</strong> Central game orchestrator and main entry point</li>
                <li><strong>Initialization:</strong> Calls <code>initScene()</code>, <code>loadBird()</code>, <code>createMountainField()</code></li>
                <li><strong>Game State:</strong> Manages pause/resume functionality via <code>isPaused</code> boolean</li>
                <li><strong>Speed Control:</strong> Exports <code>gameSpeed</code> variable (0.1x to 3.0x range)</li>
                <li><strong>Animation Loop:</strong> Contains main <code>animate()</code> function running at 60fps</li>
                <li><strong>Event Handling:</strong> Sets up "Connect MicroBit" button and voice recognition</li>
                <li><strong>Key Functions:</strong> <code>pauseGame()</code>, <code>resumeGame()</code>, <code>adjustGameSpeed()</code></li>
            </ul>

            <h3>microbit.js - Hardware Communication Interface</h3>
            <ul>
                <li><strong>Purpose:</strong> Handles all MicroBit sensor communication via Web Serial API</li>
                <li><strong>Connection:</strong> <code>connectMicrobit()</code> establishes 115200 baud serial connection</li>
                <li><strong>Data Parsing:</strong> Processes "roll,pitch,touch" format from MicroBit Python script</li>
                <li><strong>Smoothing:</strong> Applies exponential smoothing (factor 0.2) to reduce sensor noise</li>
                <li><strong>Touch Processing:</strong> Handles foil sensor with 200ms cooldown to prevent rapid firing</li>
                <li><strong>Status Management:</strong> Updates UI connection status and button states</li>
                <li><strong>Error Handling:</strong> Manages connection failures and automatic reconnection</li>
            </ul>

            <h3>bird.js - Player Character Management</h3>
            <ul>
                <li><strong>Purpose:</strong> Manages the player's bird character and all movement mechanics</li>
                <li><strong>Model Loading:</strong> Uses GLTFLoader to load bird.glb 3D model</li>
                <li><strong>Animation:</strong> Handles Three.js AnimationMixer for wing flapping</li>
                <li><strong>Movement Mapping:</strong> Converts MicroBit roll/pitch to 3D coordinates</li>
                <li><strong>Height Control:</strong> Touch sensor increases height (+20 units per touch)</li>
                <li><strong>Gravity System:</strong> Constant downward force (0.05 units/frame)</li>
                <li><strong>Boundary Constraints:</strong> X: ±170, Y: -25 to +25, Z: -120 to 0</li>
                <li><strong>Key Functions:</strong> <code>updateBirdRotation()</code>, <code>adjustHeight()</code>, <code>applyGravity()</code></li>
            </ul>

            <h3>scene.js - 3D Environment & Rendering</h3>
            <ul>
                <li><strong>Purpose:</strong> Sets up and manages the entire Three.js 3D environment</li>
                <li><strong>Scene Setup:</strong> Creates scene, camera, renderer with sky blue background</li>
                <li><strong>Lighting:</strong> Configures ambient and directional lighting with shadows</li>
                <li><strong>Camera Effects:</strong> Implements shake system for collision feedback</li>
                <li><strong>Visual Distortion:</strong> Handles smog pollution effects (color tinting, light dimming)</li>
                <li><strong>Rendering Loop:</strong> Main <code>renderScene()</code> function called 60fps</li>
                <li><strong>Window Management:</strong> Handles browser resize events</li>
                <li><strong>Key Functions:</strong> <code>initScene()</code>, <code>startCameraShake()</code>, <code>startVisualDistortionEffect()</code></li>
            </ul>

            <h3>voice.js - Speech Recognition System</h3>
            <ul>
                <li><strong>Purpose:</strong> Implements voice commands for game speed control</li>
                <li><strong>API Integration:</strong> Uses Web Speech API (webkit/standard)</li>
                <li><strong>Recognition Setup:</strong> Continuous listening with English language</li>
                <li><strong>Command Processing:</strong> Recognizes "faster", "slower", "normal" commands</li>
                <li><strong>Speed Adjustment:</strong> Calls <code>adjustGameSpeed()</code> from main.js</li>
                <li><strong>State Management:</strong> Only processes commands when MicroBit connected</li>
                <li><strong>Error Handling:</strong> Manages permission denials and recognition failures</li>
                <li><strong>Key Functions:</strong> <code>initVoiceRecognition()</code>, <code>startVoiceListening()</code>, <code>processVoiceCommand()</code></li>
            </ul>

            <h3>collisions.js - Game Logic & Scoring</h3>
            <ul>
                <li><strong>Purpose:</strong> Handles all collision detection, scoring, and game feedback</li>
                <li><strong>Hoop Collision:</strong> Detects when bird passes through golden hoops (+10 points)</li>
                <li><strong>Jet Proximity:</strong> Monitors distance to jets, triggers warning effects</li>
                <li><strong>Smog Detection:</strong> Checks proximity to smog clouds, applies visual distortion</li>
                <li><strong>Audio System:</strong> Manages game sounds (points, jets, game over)</li>
                <li><strong>Visual Effects:</strong> Triggers camera shake and screen distortion</li>
                <li><strong>Score Management:</strong> Updates and displays score in real-time</li>
                <li><strong>Key Functions:</strong> <code>checkHoopCollisions()</code>, <code>checkJetProximity()</code>, <code>checkSmogProximity()</code></li>
            </ul>

            <h3>clouds.js - Object Generation & Management</h3>
            <ul>
                <li><strong>Purpose:</strong> Manages all moving objects in the game world</li>
                <li><strong>Object Types:</strong> Regular clouds, golden hoops, jets, smog clouds</li>
                <li><strong>Procedural Generation:</strong> Creates objects at random positions (-400 to -200 Z)</li>
                <li><strong>Movement System:</strong> All objects move toward player at 1.5 × gameSpeed</li>
                <li><strong>Lifecycle Management:</strong> Spawns new objects, removes distant ones</li>
                <li><strong>Spawn Control:</strong> Only creates objects when MicroBit is connected</li>
                <li><strong>Geometry Creation:</strong> Uses Three.js primitives and GLTF models</li>
                <li><strong>Key Functions:</strong> <code>startObjectSpawning()</code>, <code>updateClouds()</code>, <code>createNewGoldenHoopAhead()</code></li>
            </ul>

            <h3>mountains.js - Background Environment</h3>
            <ul>
                <li><strong>Purpose:</strong> Creates and manages the scrolling mountain background</li>
                <li><strong>Model Loading:</strong> Loads mountain.glb 3D model once, clones for performance</li>
                <li><strong>Infinite Scrolling:</strong> Creates illusion of continuous mountain range</li>
                <li><strong>Object Pooling:</strong> Maintains 5 mountain instances, recycles as needed</li>
                <li><strong>Movement Speed:</strong> Scrolls at 0.6 × gameSpeed units per frame</li>
                <li><strong>Positioning:</strong> Mountains positioned at Y: -115 (below bird flight path)</li>
                <li><strong>Scale Management:</strong> Large scale (400x) for impressive landscape</li>
                <li><strong>Key Functions:</strong> <code>createMountainField()</code>, <code>updateMountains()</code>, <code>createMountainFromCache()</code></li>
            </ul>
        </div>

        <div class="section">
            <h2>Game Mechanics</h2>

            <h3>Movement System</h3>
            <ul>
                <li><strong>Horizontal:</strong> Roll × 3.2 sensitivity, ±170 unit bounds</li>
                <li><strong>Depth:</strong> Pitch × 2.0 sensitivity, -120 to 0 unit bounds</li>
                <li><strong>Height:</strong> Touch sensor +20 units, gravity -0.05/frame</li>
            </ul>

            <h3>Collision Detection</h3>
            <ul>
                <li><strong>Golden Hoops:</strong> +10 points, 32-unit radius detection</li>
                <li><strong>Jets:</strong> Camera shake, visual distortion, audio warning</li>
                <li><strong>Smog Clouds:</strong> Visual pollution effects, health warning</li>
            </ul>

            <h3>Environmental Systems</h3>
            <ul>
                <li><strong>Object Generation:</strong> Procedural spawning at -400 to -200 Z</li>
                <li><strong>Movement Speed:</strong> 1.5 units/frame × game speed multiplier</li>
                <li><strong>Cleanup:</strong> Remove objects beyond +50 Z position</li>
            </ul>
        </div>

        <div class="section">
            <h2>Performance Considerations</h2>
            <ul>
                <li><strong>Update Rate:</strong> MicroBit sends data at 20Hz (50ms intervals)</li>
                <li><strong>Rendering:</strong> 60fps via requestAnimationFrame</li>
                <li><strong>Object Pooling:</strong> Maximum 20 clouds, 5 active objects</li>
                <li><strong>Memory Management:</strong> Automatic cleanup of distant objects</li>
                <li><strong>Smoothing:</strong> Exponential filtering reduces sensor noise</li>
            </ul>
        </div>

        <div class="section">
            <h2>Future Architecture Considerations</h2>
            <ul>
                <li>Modular component system for easier testing</li>
                <li>Event-driven architecture for better decoupling</li>
                <li>Configuration system for game parameters</li>
                <li>Save/load system for high scores</li>
                <li>Multiplayer networking capabilities</li>
            </ul>
        </div>
    </div>
</body>
</html>